name: Clean Expired Schematics

# è§¦å‘æ¡ä»¶ï¼šå®šæ—¶ä»»åŠ¡å’Œæ‰‹åŠ¨è§¦å‘
on:
  schedule:
    # æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œæ¸…ç†ä»»åŠ¡ (UTC æ—¶é—´)
    - cron: '0 2 * * *'
  workflow_dispatch:
    # å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ

jobs:
  clean:
    runs-on: ubuntu-latest
    
    steps:
      - name: Clean expired schematics
        run: |
          # å‘æ¸…ç†ç«¯ç‚¹å‘é€ HEAD è¯·æ±‚
          curl -X HEAD \
            -w "HTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
            -s \
            "${{ secrets.CLEAN_API }}"
          
          # æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ
          if [ $? -eq 0 ]; then
            echo "âœ… æ¸…ç†ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ"
          else
            echo "âŒ æ¸…ç†ä»»åŠ¡æ‰§è¡Œå¤±è´¥"
            exit 1
          fi

      - name: Log completion
        run: |
          echo "ğŸ§¹ å®šæ—¶æ¸…ç†ä»»åŠ¡å®Œæˆäº: $(date)"
          echo "ğŸ“Š æ¸…ç†äº†è¶…è¿‡ 30 å¤©çš„è¿‡æœŸå»ºç­‘æ–‡ä»¶"